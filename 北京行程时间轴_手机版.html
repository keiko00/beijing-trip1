<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11和14北京GO</title>
    <style>
        /* 原有样式全部保留，此处省略（和之前一致） */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding-bottom: 70px;
        }
        
        .header {
            background: linear-gradient(135deg, #9E2A2B 0%, #BB3A3A 100%);
            color: white;
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 13px;
            opacity: 0.9;
        }
        
        .date-group {
            margin: 10px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .date-header {
            background-color: #BB3A3A;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            font-size: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .date-header .day-cost {
            font-size: 13px;
            opacity: 0.9;
            font-weight: normal;
        }
        
        .date-header .sun-time {
            font-size: 11px;
            opacity: 0.9;
            font-weight: normal;
            width: 100%;
            margin-top: 3px;
        }
        
        .schedule-list {
            padding: 8px 0;
        }
        
        .schedule-item {
            padding: 10px 15px;
            border-bottom: 1px solid #f1f1f1;
            display: flex;
            gap: 10px;
        }
        
        .schedule-item:last-child {
            border-bottom: none;
        }
        
        .time-tag {
            width: 85px;
            text-align: center;
            padding: 6px 3px;
            background-color: #fde8e8;
            color: #9E2A2B;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            flex-shrink: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .schedule-content {
            flex: 1;
        }
        
        .schedule-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 3px;
            color: #333;
        }
        
        .schedule-remind {
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        
        .schedule-cost {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cost-tag {
            font-size: 12px;
            font-weight: bold;
            color: #9E2A2B;
        }
        
        .cost-desc {
            font-size: 10px;
            color: #999;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
            z-index: 99;
        }
        
        .nav-item {
            text-align: center;
            color: #666;
            font-size: 11px;
        }
        
        .nav-item.active {
            color: #9E2A2B;
        }
        
        .nav-item i {
            font-size: 16px;
            margin-bottom: 3px;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .cost-page {
            padding: 10px;
        }
        
        .cost-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 12px;
            margin-bottom: 10px;
        }
        
        .cost-section h3 {
            font-size: 15px;
            color: #9E2A2B;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .total-cost {
            text-align: center;
            padding: 15px 0;
        }
        
        .total-cost .amount {
            font-size: 24px;
            font-weight: bold;
            color: #9E2A2B;
            margin-bottom: 5px;
        }
        
        .total-cost .desc {
            font-size: 12px;
            color: #666;
        }
        
        .daily-cost-list, .detail-cost-list {
            margin-top: 8px;
        }
        
        .daily-cost-item, .detail-cost-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .daily-cost-item:last-child, .detail-cost-item:last-child {
            border-bottom: none;
        }
        
        .daily-cost-item .day, .detail-cost-item .name {
            font-size: 13px;
            color: #333;
        }
        
        .daily-cost-item .cost, .detail-cost-item .cost {
            font-size: 12px;
            color: #9E2A2B;
            font-weight: bold;
        }
        
        .map-page {
            padding: 10px;
        }
        
        .map-controls {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 12px;
            margin-bottom: 10px;
        }
        
        .map-controls h3 {
            font-size: 15px;
            color: #9E2A2B;
            margin-bottom: 8px;
        }
        
        .day-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .day-btn {
            padding: 5px 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            color: #666;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .day-btn.active {
            background-color: #9E2A2B;
            color: white;
            border-color: #9E2A2B;
        }
        
        .map-container {
            width: 100%;
            height: 300px;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            overflow: hidden;
            margin: 0 auto;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .location-distance {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 12px;
            margin-top: 10px;
        }
        
        .location-distance h3 {
            font-size: 15px;
            color: #9E2A2B;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .distance-item {
            padding: 8px 0;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .distance-item:last-child {
            border-bottom: none;
        }
        
        .distance-item .route {
            font-size: 13px;
            color: #333;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .distance-item .distance {
            font-size: 11px;
            color: #9E2A2B;
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .distance-item .transport {
            font-size: 10px;
            color: #666;
            display: flex;
            gap: 15px;
        }
        
        .transport-item {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .transport-item i {
            font-size: 9px;
            color: #9E2A2B;
        }
        
        @media (max-width: 375px) {
            .time-tag {
                width: 75px;
                font-size: 10px;
            }
            .map-container {
                height: 250px;
            }
            .transport-item {
                gap: 2px;
            }
            .distance-item .transport {
                gap: 10px;
            }
        }
        
        .highlight-red {
            color: #9E2A2B;
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    
    <!-- 关键修改1：替换安全密钥配置为代理服务器地址 -->
    <script type="text/javascript">
        // 配置代理服务器地址（必须在高德API加载前设置）
        window._AMapSecurityConfig = {
            // 80端口版本（默认）
            serviceHost: "http://127.0.0.1/_AMapService",
            // 如果你改了8080端口，把上面一行换成这个：
            // serviceHost: "http://127.0.0.1:8080/_AMapService",
        };
        // 移除原有的securityJsCode配置，改为通过Nginx转发
    </script>
    
    <!-- 关键修改2：保留API Key，加载高德JS API -->
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=3bd2861bb1307c9b6f82021b723681fb"></script>
</head>
<body>
    <!-- 原有HTML结构全部保留，此处省略（和之前一致） -->
    <div class="header">
        <h1>11和14北京GO</h1>
        <p>12.31-1.3 详细行程安排</p>
    </div>
    
    <div class="page active" id="schedule-page">
        <div class="schedule-content">
            <!-- 12.31 行程 -->
            <div class="date-group">
                <div class="date-header">
                    <span>12月31日（星期三）</span>
                    <span class="day-cost">当日费用：¥6,547.00</span>
                </div>
                <div class="schedule-list">
                    <div class="schedule-item">
                        <div class="time-tag">15:40</div>
                        <div class="schedule-content">
                            <div class="schedule-title">网易→萧山机场T3</div>
                            <div class="schedule-remind">已预约包车，提前2小时到机场值机</div>
                            <div class="schedule-cost">
                                <span class="cost-tag">¥41.00</span>
                                <span class="cost-desc">网易-萧山机场接机</span>
                            </div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">17:50-20:30</div>
                        <div class="schedule-content">
                            <div class="schedule-title">杭州萧山机场T3→北京首都机场T2</div>
                            <div class="schedule-cost">
                                <span class="cost-tag">¥4,068.00</span>
                                <span class="cost-desc">杭州-北京飞机（往返2人）</span>
                            </div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">21:00-22:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">机场→酒店</div>
                            <div class="schedule-remind">已预约包车，约1小时</div>
                            <div class="schedule-cost">
                                <span class="cost-tag">¥59.00</span>
                                <span class="cost-desc">首都机场-酒店接机</span>
                            </div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">22:30</div>
                        <div class="schedule-content">
                            <div class="schedule-title">酒店休息</div>
                            <div class="schedule-cost">
                                <span class="cost-tag">¥2,379.00</span>
                                <span class="cost-desc">北京崇文门桔子水晶酒店（3晚）</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="date-group">
                <div class="date-header">
                    <span>1月1日（星期四）</span>
                    <span class="day-cost">当日费用：¥121.80</span>
                    <span class="sun-time">日出：07:36 | 日落：16:59</span>
                </div>
                <div class="schedule-list">
                    <div class="schedule-item">
                        <div class="time-tag">04:30-06:36</div>
                        <div class="schedule-content">
                            <div class="schedule-title">天安门广场升旗</div>
                            <div class="schedule-remind">西红墙安检01入场，带身份证+折叠凳+暖宝宝+保温杯热水</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">08:00-11:30</div>
                        <div class="schedule-content">
                            <div class="schedule-title">天安门广场→酒店休息</div>
                            <div class="schedule-remind">车程20min，回酒店补觉</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">12:00-13:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">附近午餐</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">13:00-16:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">天安门城楼 + 人民大会堂 + 天坛公园</div>
                            <div class="schedule-remind">1. 登天安门城楼俯瞰广场；<br>2. 参观人民大会堂外景 / 内部；<br>3. 逛天坛公园，打卡祈年殿，回音壁；<span class="highlight-red">南门涮肉</span></div>
                            <div class="schedule-cost">
                                <span class="cost-tag">¥121.80</span>
                                <span class="cost-desc">天安门城楼（2人）：65.8元；天坛公园（2人）：56元</span>
                            </div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">16:00-19:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">什刹海冰场</div>
                            <div class="schedule-remind">现场购票，带身份证<br>傍晚灯光亮起时拍照氛围感拉满</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">19:00-20:30</div>
                        <div class="schedule-content">
                            <div class="schedule-title">前门大街晚餐</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">20:30后</div>
                        <div class="schedule-content">
                            <div class="schedule-title">酒店</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="date-group">
                <div class="date-header">
                    <span>1月2日（星期五）</span>
                    <span class="day-cost">当日费用：¥753.00</span>
                    <span class="sun-time">日落：17:00</span>
                </div>
                <div class="schedule-list">
                    <div class="schedule-item">
                        <div class="time-tag">10:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">西扶海棠-格格妆造</div>
                            <div class="schedule-remind">11点档期，王府世纪6楼601A<br>行程半小时，需提前半小时到</div>
                            <div class="schedule-cost">
                                <span class="cost-tag">¥499.00</span>
                                <span class="cost-desc">单人仅妆造</span>
                            </div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">13:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">故宫角楼外景拍摄+附近午餐</div>
                            <div class="schedule-remind">东华门 / 午门广场 / 故宫角楼（外景）拍摄</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">13:00-16:30</div>
                        <div class="schedule-content">
                            <div class="schedule-title">故宫博物院</div>
                            <div class="schedule-remind">下午场（11:00后入园），15:30神武门出<br>中轴线 + 御花园 + 珍宝馆 + 钟表馆</div>
                            <div class="schedule-cost">
                                <span class="cost-tag">¥246.00</span>
                                <span class="cost-desc">含珍宝馆+钟表馆（2人）</span>
                            </div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">16:30-17:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">神武门→西扶海棠归还衣服</div>
                            <div class="schedule-remind">最晚19:00 归还</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">17:00-17:30</div>
                        <div class="schedule-content">
                            <div class="schedule-title">景山公园</div>
                            <div class="schedule-remind">登万春亭，俯瞰故宫全景，17:00 前入园<br>19：30停止入园，20：00闭园<br>园内景点院落16：30停止进入，17：00关门</div>
                            <div class="schedule-cost">
                                <span class="cost-tag">¥4.00</span>
                                <span class="cost-desc">门票（2人）</span>
                            </div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">17:30-19:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">三里屯/北新桥晚餐</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">19:00后</div>
                        <div class="schedule-content">
                            <div class="schedule-title">酒店</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="date-group">
                <div class="date-header">
                    <span>1月3日（星期六）</span>
                    <span class="day-cost">当日费用：¥0.00</span>
                </div>
                <div class="schedule-list">
                    <div class="schedule-item">
                        <div class="time-tag">09:00-12:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">地坛公园 / 五道营胡同</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">12:00-14:00</div>
                        <div class="schedule-content">
                            <div class="schedule-title">附近午餐</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">15:00-17:45</div>
                        <div class="schedule-content">
                            <div class="schedule-title">酒店→北京首都机场</div>
                            <div class="schedule-remind">提前 2 小时到机场，地铁机场线约 40 分钟</div>
                        </div>
                    </div>
                    <div class="schedule-item">
                        <div class="time-tag">19:45-21:50</div>
                        <div class="schedule-content">
                            <div class="schedule-title">北京首都机场T3→杭州萧山机场T3</div>
                            <div class="schedule-remind">已含在往返机票中</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="page" id="cost-page">
        <div class="cost-page">
            <div class="cost-section">
                <h3>总费用统计</h3>
                <div class="total-cost">
                    <div class="amount">¥7,421.80</div>
                    <div class="desc">北京4日行程总费用（2人）</div>
                </div>
            </div>
            
            <div class="cost-section">
                <h3>每日费用明细</h3>
                <div class="daily-cost-list">
                    <div class="daily-cost-item">
                        <span class="day">12月31日（星期三）</span>
                        <span class="cost">¥6,547.00</span>
                    </div>
                    <div class="daily-cost-item">
                        <span class="day">1月1日（星期四）</span>
                        <span class="cost">¥121.80</span>
                    </div>
                    <div class="daily-cost-item">
                        <span class="day">1月2日（星期五）</span>
                        <span class="cost">¥753.00</span>
                    </div>
                    <div class="daily-cost-item">
                        <span class="day">1月3日（星期六）</span>
                        <span class="cost">¥0.00</span>
                    </div>
                </div>
            </div>
            
            <div class="cost-section">
                <h3>核心费用明细</h3>
                <div class="detail-cost-list">
                    <div class="detail-cost-item">
                        <span class="name">杭州-北京往返机票（2人）</span>
                        <span class="cost">¥4,068.00</span>
                    </div>
                    <div class="detail-cost-item">
                        <span class="name">酒店住宿（3晚）</span>
                        <span class="cost">¥2,379.00</span>
                    </div>
                    <div class="detail-cost-item">
                        <span class="name">故宫门票（含展馆）</span>
                        <span class="cost">¥246.00</span>
                    </div>
                    <div class="detail-cost-item">
                        <span class="name">西扶海棠妆造</span>
                        <span class="cost">¥499.00</span>
                    </div>
                    <div class="detail-cost-item">
                        <span class="name">景山公园门票</span>
                        <span class="cost">¥4.00</span>
                    </div>
                    <div class="detail-cost-item">
                        <span class="name">天安门城楼+天坛公园（2人）</span>
                        <span class="cost">¥121.80</span>
                    </div>
                    <div class="detail-cost-item">
                        <span class="name">其他交通费用</span>
                        <span class="cost">¥100.00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="page" id="map-page">
        <div class="map-page">
            <div class="map-controls">
                <h3>行程地图</h3>
                <div class="day-selector">
                    <button class="day-btn active" data-day="31">12月31日</button>
                    <button class="day-btn" data-day="01">1月1日</button>
                    <button class="day-btn" data-day="02">1月2日</button>
                    <button class="day-btn" data-day="03">1月3日</button>
                </div>
                <p style="font-size:11px;color:#666;">点击日期查看对应行程位置和交通信息</p>
            </div>
            
            <div class="map-container">
                <div id="map"></div>
            </div>
            
            <div class="location-distance">
                <h3 id="distance-title">12月31日 核心位置距离</h3>
                <div id="distance-list" class="distance-list">
                </div>
            </div>
        </div>
    </div>
    
    <div class="bottom-nav">
        <div class="nav-item active" data-page="schedule-page">
            <i class="fa fa-calendar"></i>
            <div>行程表</div>
        </div>
        <div class="nav-item" data-page="cost-page">
            <i class="fa fa-money"></i>
            <div>费用统计</div>
        </div>
        <div class="nav-item" data-page="map-page">
            <i class="fa fa-map-marker"></i>
            <div>行程地图</div>
        </div>
    </div>
    
    <script>
        // 页面切换功能
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(this.dataset.page).classList.add('active');
                
                if (this.dataset.page === 'map-page' && !mapInitialized) {
                    initMap();
                }
            });
        });
        
        const distanceData = {
            '31': [
                {
                    route: '首都机场T2 → 桔子水晶酒店（崇文门店）',
                    distance: '约28公里',
                    carTime: '车程45分钟',
                    publicTime: '地铁2号线约1小时10分钟'
                }
            ],
            '01': [
                {
                    route: '酒店 → 天安门广场',
                    distance: '约3.5公里',
                    carTime: '车程15分钟',
                    publicTime: '地铁5号线转1号线约25分钟'
                },
                {
                    route: '天安门广场 → 天坛公园',
                    distance: '约4.2公里',
                    carTime: '车程20分钟',
                    publicTime: '地铁5号线约30分钟'
                },
                {
                    route: '天坛公园 → 什刹海冰场',
                    distance: '约7.8公里',
                    carTime: '车程30分钟',
                    publicTime: '地铁8号线转6号线约40分钟'
                }
            ],
            '02': [
                {
                    route: '酒店 → 故宫博物院',
                    distance: '约4.8公里',
                    carTime: '车程25分钟',
                    publicTime: '地铁5号线转1号线约35分钟'
                },
                {
                    route: '故宫博物院 → 景山公园',
                    distance: '约0.8公里',
                    carTime: '车程5分钟',
                    publicTime: '步行约10分钟'
                },
                {
                    route: '景山公园 → 三里屯',
                    distance: '约7.5公里',
                    carTime: '车程25分钟',
                    publicTime: '地铁6号线转10号线约40分钟'
                }
            ],
            '03': [
                {
                    route: '酒店 → 地坛公园',
                    distance: '约5.2公里',
                    carTime: '车程20分钟',
                    publicTime: '地铁5号线约25分钟'
                },
                {
                    route: '地坛公园 → 五道营胡同',
                    distance: '约0.5公里',
                    carTime: '车程3分钟',
                    publicTime: '步行约8分钟'
                },
                {
                    route: '酒店 → 首都机场T3',
                    distance: '约29公里',
                    carTime: '车程50分钟',
                    publicTime: '地铁2号线转机场线约1小时15分钟'
                }
            ]
        };
        
        function updateDistanceInfo(day) {
            const dayNames = {
                '31': '12月31日',
                '01': '1月1日',
                '02': '1月2日',
                '03': '1月3日'
            };
            
            document.getElementById('distance-title').textContent = `${dayNames[day]} 核心位置距离`;
            
            const distanceList = document.getElementById('distance-list');
            distanceList.innerHTML = '';
            
            distanceData[day].forEach(item => {
                const distanceItem = document.createElement('div');
                distanceItem.className = 'distance-item';
                distanceItem.innerHTML = `
                    <div class="route">${item.route}</div>
                    <div class="distance">${item.distance}</div>
                    <div class="transport">
                        <div class="transport-item">
                            <i class="fa fa-car"></i> ${item.carTime}
                        </div>
                        <div class="transport-item">
                            <i class="fa fa-subway"></i> ${item.publicTime}
                        </div>
                    </div>
                `;
                distanceList.appendChild(distanceItem);
            });
        }
        
        let map, markers = {}, currentDay = '31', mapInitialized = false;
        
        function initMap() {
            if (mapInitialized) return;
            
            try {
                const mapLoadTimeout = setTimeout(() => {
                    throw new Error('地图加载超时');
                }, 10000);
                
                map = new AMap.Map('map', {
                    zoom: 12,
                    center: [116.413384, 39.908823],
                    resizeEnable: true,
                    scrollWheel: true,
                    logoPosition: 'RB',
                    mapStyle: 'amap://styles/normal',
                    animateEnable: false
                });
                
                clearTimeout(mapLoadTimeout);
                
                map.addControl(new AMap.Scale());
                map.addControl(new AMap.ToolBar({
                    position: 'RB'
                }));
                
                const locations = {
                    '31': [{ name: '桔子水晶酒店', lnglat: [116.413384, 39.908823] }, { name: '首都机场T2', lnglat: [116.600939, 40.072455] }],
                    '01': [{ name: '桔子水晶酒店', lnglat: [116.413384, 39.908823] }, { name: '天安门广场', lnglat: [116.397470, 39.908689] }, { name: '天坛公园', lnglat: [116.419850, 39.881820] }, { name: '什刹海冰场', lnglat: [116.396507, 39.942976] }],
                    '02': [{ name: '桔子水晶酒店', lnglat: [116.413384, 39.908823] }, { name: '故宫博物院', lnglat: [116.390631, 39.916404] }, { name: '景山公园', lnglat: [116.393800, 39.924400] }, { name: '三里屯', lnglat: [116.465100, 39.936300] }],
                    '03': [{ name: '桔子水晶酒店', lnglat: [116.413384, 39.908823] }, { name: '地坛公园', lnglat: [116.441800, 39.936700] }, { name: '五道营胡同', lnglat: [116.445200, 39.938500] }, { name: '首都机场T3', lnglat: [116.607960, 40.076570] }]
                };
                
                for (const day in locations) {
                    markers[day] = [];
                    locations[day].forEach(loc => {
                        const marker = new AMap.Marker({
                            position: loc.lnglat,
                            title: loc.name,
                            map: day === currentDay ? map : null,
                            label: { 
                                content: loc.name, 
                                offset: new AMap.Pixel(0, -20), 
                                fontSize: '11px',
                                className: 'custom-marker-label'
                            },
                            icon: new AMap.Icon({
                                size: new AMap.Size(24, 36),
                                image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                                imageSize: new AMap.Size(24, 36)
                            })
                        });
                        markers[day].push(marker);
                    });
                }
                
                updateDistanceInfo(currentDay);
                
                document.querySelectorAll('.day-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        
                        markers[currentDay].forEach(m => m.setMap(null));
                        currentDay = this.dataset.day;
                        markers[currentDay].forEach(m => m.setMap(map));
                        map.setCenter(markers[currentDay][0].getPosition());
                        
                        updateDistanceInfo(currentDay);
                    });
                });
                
                mapInitialized = true;
            } catch (e) {
                document.getElementById('map').innerHTML = `
                    <div style="width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:12px;color:#666;padding:20px;text-align:center;">
                        <i class="fa fa-map-o" style="font-size:30px;margin-bottom:10px;color:#9E2A2B;"></i>
                        <div>地图加载失败</div>
                        <div style="font-size:10px;margin-top:5px;">错误原因：${e.message}</div>
                        <div style="font-size:10px;margin-top:5px;">排查建议：</div>
                        <div style="font-size:9px;margin-top:3px;text-align:left;line-height:1.5;">
                            1. 检查Nginx代理配置是否正确<br>
                            2. 确认代理服务器可访问<br>
                            3. 检查API Key是否有效
                        </div>
                    </div>
                `;
                console.error('地图加载失败:', e);
                updateDistanceInfo(currentDay);
            }
        }
        
        window.addEventListener('load', () => {
            updateDistanceInfo(currentDay);
            
            setTimeout(() => {
                if (document.getElementById('map-page').classList.contains('active')) {
                    initMap();
                }
            }, 500);
        });
        
        const style = document.createElement('style');
        style.textContent = `
            .custom-marker-label {
                background: rgba(255,255,255,0.9);
                padding: 2px 5px;
                border-radius: 2px;
                border: 1px solid #ddd;
                white-space: nowrap;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
